\documentclass[letterpaper,final,12pt,reqno]{amsart}

\usepackage[total={6.3in,9.2in},top=1.1in,left=1.1in]{geometry}

\usepackage{bm}
\usepackage{empheq}
\usepackage[dvipsnames]{xcolor}
\usepackage{graphicx}
\usepackage{verbatim,fancyvrb}
\usepackage{tikz}

% hyperref should be the last package we load
\usepackage[pdftex,
colorlinks=true,
plainpages=false, % only if colorlinks=true
linkcolor=blue,   % only if colorlinks=true
citecolor=Red,   % only if colorlinks=true
urlcolor=black     % only if colorlinks=true
]{hyperref}

\renewcommand{\baselinestretch}{1.05}

\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\newcommand{\pp}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
\renewcommand{\t}[1]{\texttt{#1}}
\newcommand{\Matlab}{\textsc{Matlab}\xspace}
\newcommand{\eps}{\epsilon}
\newcommand{\RR}{\mathbb{R}}

\newcommand{\grad}{\nabla}
\newcommand{\Div}{\nabla\cdot}
\newcommand{\trace}{\operatorname{tr}}

\newcommand{\hbn}{\hat{\mathbf{n}}}

\newcommand{\bg}{\mathbf{g}}
\newcommand{\bn}{\mathbf{n}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bv}{\mathbf{v}}
\newcommand{\bx}{\mathbf{x}}

\newcommand{\bX}{\mathbf{X}}

\newtheorem{lemma}{Lemma}



\begin{document}
\title{Evolving-surface glacier flow using Stokes dynamics}

\author{Ed Bueler}

\maketitle

\thispagestyle{empty}
\bigskip

\section{Model equations in strong form} \label{sec:strongform}

Our conservation of momentum model for ice flow is the set of shear-thinning (Glen law) Stokes equations with glacier-suitable boundary conditions.\footnote{version: \today}  This model is described in \cite{GreveBlatter2009,JouvetRappaz2011}.  For these notes it applies on a 2D domain $\Omega$ occupied by the ice, in variables $(x,z)$ with $z$ at angle $\alpha$ to the vertical (below).  The domain $\Omega \subset \RR^2$ which must have a piecewise smooth boundary so that we may apply the boundary conditions, and in fact it will evolve, but it is otherwise general.

Allowing any Glen exponent $n\ge 1$, the strong form model equations are:
\begin{align}
- \nabla \cdot \tau + \nabla p &= \rho \bg &&\text{\emph{stress balance}} \label{forcebalance} \\
\nabla \cdot \bu &= 0 &&\text{\emph{incompressibility}} \label{incompressible} \\
\tau &= B_n |D\bu|^{\frac{1}{n} - 1} D\bu  &&\text{\emph{viscosity-form flow law}} \label{viscflowlaw}
\end{align}
Here we have velocity $\bu$, pressure $p$, ice density $\rho$ (constant), acceleration of gravity $\bg = \left<g\sin\alpha,-g\cos\alpha\right>$ where $g>0$, deviatoric stress tensor $\tau$, and strain rate tensor $D\bu$.  Tensors $D\bu$ and $\tau$ are symmetric and have trace zero.  Recall $D\bu$ is the symmetric part of $\grad \bu$, $(D\bu)_{ij} = \frac{1}{2} \left(\grad\bu + \grad\bu^\top\right)$.  The full (Cauchy) stress tensor $\sigma$ is the deviatoric stress tensor $\tau$ minus the pressure, $\sigma = \tau - p\,I$, so equation \eqref{forcebalance} simply says $-\Div \sigma = \rho \bg$.  Note that $\tau = 2\nu D\bu$ where $\nu$ is the \emph{effective viscosity}, i.e.~$\nu=(1/2)B_n |D\bu|^{\frac{1}{n} - 1}$, $B_n = (A_n)^{-1/n}$ is the $n$-dependent \emph{ice hardness} in units $\text{Pa}\,\text{s}^{1/n}$, and the tensor norm is $|D\bu|^2 = \frac{1}{2} \trace\left((D\bu)^2\right) = \frac{1}{2} (D\bu)_{ij} (D\bu)_{ij}$.

From \eqref{viscflowlaw} we can eliminate $\tau$ from equation \eqref{forcebalance}, thereby rewriting the system in terms of velocity and pressure only:
\begin{align}
- \nabla \cdot \left(B_n |D\bu|^{\frac{1}{n} - 1} D\bu\right) + \nabla p &= \rho \mathbf{g} \label{stokes} \\
\Div \bu &= 0 \label{incompagain}
\end{align}
This system is the Glen-Stokes model, and a solution is a velocity-pressure pair $(\bu,p)$.

Certain glacier-suitable velocity and stress boundary conditions will be used here.  We assume that the base, top, inflow, and outflow boundaries can all be identified.  On the base we require no slip:
\begin{align}
\bu &= 0  &&\text{\emph{base}} \label{basebc} \\
\intertext{On the top we set a condition of zero applied stress, i.e.~$\sigma\hbn=0$:}
\left(B_n |D\bu|^{\frac{1}{n} - 1} D\bu - pI\right) \hbn &= 0  &&\text{\emph{top}} \label{topbc} \\
\intertext{The left-side inflow boundary has outward normal $\hbn=\left<-1,0\right>^\top$ in our case, and on this surface we set a nonzero inflow velocity:}
\bu &= \left<f(z),0\right>^\top  &&\text{\emph{inflow}} \label{inflowbc} \\
\intertext{The function $f(z)$ satisfies the slab-on-slope equations for a specific thickness $H_{\text{in}}$ at the inflow.  On the outflow boundary, where $\hbn=\left<1,0\right>^\top$, we set a nonzero hydrostatic normal stress using the (varying) ice thickness $H_{\text{out}}$ at the outflow:}
\left(B_n |D\bu|^{\frac{1}{n} - 1} D\bu - pI\right) \hbn &= C_{\text{out}} \big<- \rho g \cos\alpha (H_{\text{out}}-z), &&\text{\emph{outflow}} \label{outflowbc} \\
    &\qquad\qquad \rho g\sin\alpha (H_{\text{out}}-z)\big>^\top  \notag
\end{align}
The constant $C_{\text{out}} $ is adjusted so that the total applied stress is equal to its value for the input ice thickness $H_{\text{in}}$, thus $C_{\text{out}} = (H_{\text{in}}/H_{\text{out}})^2$.

The above equations determine the velocity and pressure in the ice from the boundary conditions, and from the geometry of the ice domain $\Omega$, but they do not determine how the glacier changes shape.  Noting that one aspect of conservation of mass is already stated above, namely the incompressibility relation in the interior of $\Omega$, to evolve the glacier geometry we will need to add the conservation of mass statement on $\partial\Omega$, namely the surface kinematical equation \eqref{surfacekinematical} below.

Thus from now on we will suppose that the domain is time-dependent:
\begin{equation}
\Omega^t = \left\{(x,z)\,\big|\, b(x) < z < h(x,t)\right\}.  \label{Omegat}
\end{equation}
Here $z=b(x)$ is the base elevation and $z=h(x,t)$ is the ice surface elevation.  Note the key fact that
\begin{equation}
h(x,t) \ge b(x).  \label{admissibility}
\end{equation}

Using ice velocity $\bu=\left<u(x,z,t),w(x,z,t)\right>$, the surface kinematical equation is
\begin{equation}
h_t = a(x,h,t) - u(x,h,t) h_x + w(x,h,t) \label{surfacekinematical}
\end{equation}
Here $a(x,z,t)$ is the (modeled) climatic mass balance in units of ice-equivalent $\text{m}\,\text{s}^{-1}$.  Informally, \eqref{surfacekinematical} determines the change in surface elevation $\Delta h \approx h_t\,\Delta t$ from the climatically added/removed ice $a\,\Delta t$ plus the component of the ice motion in the outward (upward) normal direction $\bn = \left<-h_x,1\right>$, so one may say that the time-dependent surface $z=h(x,t)$ evolves by steps $\Delta h \approx \left(a + \bn\cdot \bu|_{z=h}\right) \Delta t$.


\section{Weak form of the decoupled Glen-Stokes equations} \label{sec:weakformstokes}

At any time $t$, if the ice geometry $\Omega^t$ is known then the solution to Glen-Stokes model \eqref{stokes}, \eqref{incompagain} is a pair $(\bu,p)$.  That is, in a Stokes model the slowness of the fluid ($\text{Re}=0$) implies that the boundary stresses and body force instantaneously determine the velocity and pressure fields within the fluid.  As is standard in the literature \cite{BuelerBook,JouvetRappaz2011}, one may write a weak form for these momentum balance equations, decoupled from the mass conservation boundary equation \eqref{surfacekinematical}.

For the weak form we seek a solution with $\bu\in V_D \subset W^{1,p}(\Omega^t)$ and $p \in Q=L^{p'}(\Omega^t)$.  Test functions $\bv\in V_0 \subset W^{1,p}(\Omega^t)$ and $q\in Q$ come from nearly the same spaces: $\bu\in V_D$ satisfies base and inflow boundary conditions \eqref{basebc} and \eqref{inflowbc}, respectively, while $\bv\in V_0$ is zero on those boundaries.  FIXME: clarify spaces a bit

To give an initial definition of $F$ we multiply \eqref{stokes} by $\bv\in V_0$ and \eqref{incompagain} by $q\in Q$, then add and integrate-by-parts:
\begin{equation}
\tilde F = -\int_{\partial\Omega^t} (\sigma \hbn)\cdot \bv\,d\ell + \int_{\Omega^t} \tau \,:\,D\bv - p (\nabla \cdot \bv) - \left(\nabla \cdot \bu\right) q - \rho \mathbf{g} \cdot \bv \,dx dz \label{nonfunctwo}
\end{equation}
where $d\ell$ is the arclength element along $\partial\Omega^t$, and denoting $\sigma=\tau-pI$ for brevity.  Note $\bu,\bv$ appear with at most first derivatives and $p,q$ appear without derivatives.

By definition, $\bv\in V_0$ satisfies $\bv=0$ along the base and inflow surfaces.  Thus these parts of the integral over $\partial\Omega$ in \eqref{nonfunctwo} are zero.  Conditions \eqref{topbc}, \eqref{outflowbc} now completely eliminate the unknowns from the boundary integral, yielding a final formula for $\tilde F$:
\begin{align}
\tilde F(\bu,p;\bv,q) &= \int_{\Omega^t} B_n |D\bu|^{\frac{1}{n} - 1} D\bu\,:\,D\bv - p (\nabla \cdot \bv) - \left(\nabla \cdot \bu\right) q \,dx dz \label{defineF} \\
    &\qquad  - \int_{\Omega^t} \rho \mathbf{g} \cdot \bv \,dx dz - \int_{\{\text{outflow}\}} C_{\text{out}} \rho g \cos\alpha (h-z) v \,d\ell \notag
\end{align}
The last two integrals can be regarded as source terms; if the inflow velocity is zero and these source terms are zero then the unique solution is $\bu=0$ and $p=0$.  The weak form is the statement that $\bu\in V_D$ and $p\in Q$ satisfy
\begin{equation}
\tilde F(\bu,p;\bv,q) = 0 \qquad \text{ for all } \bv\in V_0 \text{ and } q\in Q  \label{weak}
\end{equation}

Essentially this weak formulation is proven in \cite[Theorem 3.8]{JouvetRappaz2011} to be well-posed under reasonable assumptions about the domain $\Omega$ and boundary data which are satisfied in the cases we consider.


\section{Implicit time-discretization} \label{sec:implicitstep}

We propose an implicit moving-mesh scheme to simultaneously solve the Glen-Stokes equations and the surface kinematical equation.  Essentially we compute the strain (displacement) implicitly from the principle of mass conservation, and simultaneously with the momentum conservation equations, at each step.  After stating this scheme using a time-discretized, continuous-space formulation, the main task becomes to change variables in the integrals which define the Stokes weak form.  The finite element solution of the resulting equations is considered in the next section.

Initially we will describe the time-stepping using a backward Euler scheme.  This presentation is somewhat inflexible because better implicit schemes exist.  In later work we could state the problem as a differential algebraic equation (DAE) and apply a higher-order scheme like a second-order backward-differentiation formula (BDF2) \cite{AscherPetzold1998}, and use tools like PETSc's TS object \cite{Balayetal2020,BuelerBook} or \texttt{firedrake-ts}.\footnote{\url{https://github.com/IvanYashchuk/firedrake-ts}}

Consider consecutive times $t_{n-1}$ and $t_n$ with step $\Delta t = t_n - t_{n-1} > 0$.  Suppose the model's state, namely the (current) ice geometry, is known at time $t_{n-1}$.  Denote this ice-filled domain as $\Lambda = \Omega^{n-1} \subset \RR^2$.  We plan to approximate the updated (new) domain $\Omega^n \subset \RR^2$ using the surface kinematical equation \eqref{surfacekinematical}, the surface mass balance $a(x,z,t)$, and the Glen-Stokes equations \eqref{weak}.

The coordinates on region $\Lambda$ will be denoted $(r,s)$, and we update the region via a particular change of coordinates $(r,s) \mapsto (x,z)$:
\begin{equation}
\Lambda \stackrel{\Delta t}{\to} \Omega^n: \qquad x(r,s)=r, \quad z(r,s)=s+c(r,s). \label{changecoords}
\end{equation}
Here $c(r,s)$ is a scalar function which is to be determined (below).  Note that the horizontal coordinate is not changed ($x=r$) but the $z$-coordinate is nontrivial.  In any case the new domain $\Omega^n$ is an image of the current domain $\Lambda$,
\begin{equation}
\Omega^n = \{(x,z)=(r,s+c(r,s)) \,\big|\, (r,s) \in \Lambda\}.  \label{updateddomain}
\end{equation}

FIXME a figure here showing $\Lambda$ on left and $\Omega^n$ on right

The top of the icy region is described by the surface elevation function.  Let us acknowledge a ``shallowness'' assumption here, namely that for every $x$-coordinate value there is a single, well-defined surface elevation.  That is, from now on we assume that
\begin{equation}
I(r) = \{s\,:\,(r,s) \in \Lambda\} \subset \RR \, \text{ is a single interval for every } r.\label{intervalassume}
\end{equation}
(In fact the intervals are open because $\Lambda$ is itself open, but this is of no importance in the notation.)  Note that this is an assumption about $\Lambda$, the current icy domain, but that, once we have solved all the upcoming equations, it must also hold for $\Omega^n$ so that time-stepping may proceed.  Now
    $$h(r) = \sup I(r), \qquad b(r) = \inf I(r)$$
define the ice-surface and base elevation functions for the current domain $\Lambda$.  (One could denote $h(r)$ as $h^{n-1}(r)$, but at the cost of clutter.)

The change of coordinates will be differentiable on $\Lambda$ because the nontrivial part, the function $c$, will solve an elliptic PDE.  From \eqref{changecoords} the Jacobian of the change is
\begin{equation}
J = \begin{pmatrix} \partial x / \partial r & \partial x / \partial s \\ {\large\strut} \partial z / \partial r & \partial z / \partial s \end{pmatrix} = \begin{pmatrix} 1 & 0 \\ \partial c/\partial r & 1+(\partial c/\partial s) \end{pmatrix}. \label{jacchange}
\end{equation}
For a generic, smooth, scalar-valued function $\tilde f(x,z)$ defined on $\Omega^n$ we define a new function on $\Lambda$,
    $$f(r,s) = \tilde f(r,s+c(r,s)),$$
and its partial derivatives transform as
\begin{equation}
\begin{bmatrix} \partial \tilde f / \partial x \\ {\large\strut} \partial \tilde f / \partial z\end{bmatrix} = (J^\top)^{-1} \begin{bmatrix} \partial f / \partial r \\ {\large\strut} \partial f / \partial s\end{bmatrix} = \begin{pmatrix} 1 & \ell \\ 0 & k \end{pmatrix} \begin{bmatrix} \partial f / \partial r \\ {\large\strut} \partial f / \partial s\end{bmatrix} \label{changederivatives}
\end{equation}
where
\begin{equation}
k(r,s) = j(r,s)^{-1}, \qquad \ell(r,s) = - \frac{\partial c}{\partial r}(r,s) j(r,s)^{-1}.
\end{equation}

With these formulas we can rewrite the surface kinematical equation \eqref{surfacekinematical}.  First, given \eqref{updateddomain}, the updated ice surface elevation is
    $$h^n(r) = z(r,h(r)) = h(r) + c(r,h(r)),$$
defined for $r$ in $\Lambda$.  The value $c(r,h(r))$ is defined in a trace sense \cite{Evans2010}; see below for the Sobolev space containing $c$.  The backward-Euler form of \eqref{surfacekinematical} will approximate the time derivative by $h_t \approx (h^n(r) - h(r))/\Delta t$, thus at the location $(r,h^n(r))$ on the boundary of $\Omega^n$, \eqref{surfacekinematical} becomes
\begin{align}
\frac{c(r,h(r))}{\Delta t} &= a^n(r) - u(r,h(r))\,\frac{d}{d r} h^n(r) + w(r,h(r)) \notag \\
  &= a^n(r) - u(r,h(r))\,\left(h'(r) + \frac{\partial c}{\partial r}(r,h(r)) + h'(r) \frac{\partial c}{\partial s}(r,h(r))\right) + w(r,h(r)) \label{surfaceimplicitearly}
\end{align}
where $\bu(r,s)=\left<u,w\right>$ is the solution of the other equations (i.e.~the Stokes weak form; see below) as a function of $(r,s)\in\Lambda$.  Also $a^n(r) = a\left(r,h(r) + c(r,h(r)),t_n\right)$ is the mass balance computed at the updated surface location and the updated time.  Stated more simply, \eqref{surfaceimplicitearly} will be regarded as a Robin boundary condition for the unknown function $c(r,s)$ at an arbitrary surface location of $\Lambda$:
\begin{equation}
c + \Delta t\,u \frac{\partial c}{\partial r} + \Delta t\,(1+h') u \frac{\partial c}{\partial s} = \Delta t \left(a^n + w\right). \label{surfaceimplicit}
\end{equation}
Note \eqref{surfaceimplicit} implies a coupling between surface elevation and mass balance during the solve, a complication which can be avoided by the (semi-explicit) approximation using the current surface elevation: $a^n \approx a(r,h(r),t_n)$.

As we will be rewriting the weak form \eqref{defineF} as integrals over $(r,s)\in \Lambda$, note the following expansions of the derivatives with respect to $(x,z)$.  In particular we use \eqref{changederivatives} and component notation $\bu = \left<u_0,u_2\right>$, compatible with coordinate notation $(x,z)$ on $\Omega$:
\begin{align*}
\grad_{x,z} \cdot \tilde \bu &= \frac{\partial u_0}{\partial r} + \ell \frac{\partial u_0}{\partial s} + k \frac{\partial u_2}{\partial s} \\
D_{x,z} \tilde \bu &= \begin{pmatrix} \partial u_0/\partial r + \ell (\partial u_0/\partial s) & \frac{1}{2}\left(k (\partial u_0/\partial s) + \partial u_2/\partial r + \ell (\partial u_2/\partial s)\right) \\
  {\large\strut} \frac{1}{2}\left(k (\partial u_0/\partial s) + \partial u_2/\partial r + \ell (\partial u_2/\partial s)\right) & k (\partial u_2/\partial s)\end{pmatrix} \\
|D_{x,z} \tilde \bu|^2 &= \frac{1}{2}\left(\frac{\partial u_0}{\partial r} + \ell \frac{\partial u_0}{\partial s}\right)^2 + \frac{1}{2}\left(k \frac{\partial u_0}{\partial s} + \frac{\partial u_2}{\partial r} + \ell \frac{\partial u_2}{\partial s}\right)^2 + \frac{1}{2}\left(k \frac{\partial u_2}{\partial s}\right)^2 \\
\end{align*}

The change of variables also rewrites integrals over the solution domain $\Omega^n$.  For example, consider a generic scalar-valued $L^1$ function $\tilde f(x,z)$ defined on $\Omega^n$.  By the change of variables theorem we have
\begin{equation}
\int_{\Omega^n} \tilde f(x,z)\,dx dz = \int_\Lambda \tilde f(x(r,s),z(r,s)) \, j(r,s)\,dr ds, \label{changeintegralearly}
\end{equation}
with weighting $j(r,s)$ equal to the determinant of $J$, thus
\begin{equation}
j(r,s) = 1+\frac{\partial c}{\partial s}  \label{jacchangedet}
\end{equation}
For stability the change of coordinates must not cause a local flip in orientation,though degeneration is allowed.  That is, we will require $j\ge 0$ or equivalently
\begin{equation}
\frac{\partial c}{\partial s} \ge -1.\label{differentialVI}
\end{equation}
For integral \eqref{changeintegralearly} we again denote the function defined on $\Lambda$ by $f(r,s) = \tilde f(r,s+c(r,s))$, and thus we get a final integral change-of-variables formula
\begin{equation}
\int_{\Omega^n} \tilde f(x,z)\,dx dz = \int_\Lambda f(r,s) \, j(r,s)\,dr ds. \label{changeintegral}
\end{equation}


FIXME state the weak form using independent variables $r,s$ and integrals over $\Lambda$


\section{Inequality constraints and mass accounting}

\begin{lemma}
Assume that the ice thickness is well defined at time $t_{n-1}$, that is, assume
\eqref{intervalassume}.  If inequality \eqref{differentialVI} holds then the updated ice surface elevation
    $$h(r,t_n) = \sup_{s\in I(r)}\{z(r,s)\}$$
satisfies \eqref{admissibility}, i.e.~$h(r,t_n)\ge b(r)$.
\end{lemma}

\begin{proof}
FIXME? This is the fundamental theorem of calculus:
    $$h(r,t_n) - b(r) = \int_{I(r)} 1\,ds \le \int_{I(r)} - \frac{\partial c}{\partial s}\,ds$$
\end{proof}

FIXME Main points:
\renewcommand{\labelenumi}{\arabic{enumi}.}
\begin{enumerate}
\item equations are for four scalar functions $u,v,p,c$, of $(r,s) \in \Lambda$, where $\bu=\left<u,v\right>$ is the vector velocity, $p$ is the pressure, and $c$ is the vertical mesh displacement
\item the $z$ value at the ice surface solves the time-discretized surface kinematical equation re-written into $(r,s)$ coordinates; this is a Robin boundary condition for $c$
\item in the interior of $\Lambda$, the difference $c(r,s)=z(r,s)-s$ solves the Laplace equation subject to boundary values as follows:
    \begin{itemize}
    \item Robin on surface from surface kinematical equation
    \item zero Dirichlet on base and inflow; these mesh nodes do not move
    \item Neuman on outflow
    \end{itemize}
\item numerical solver should check element orientation under change of coordinates (above); if the solver flips an element then it is bad; also check new element aspect ratio and (presumably) remesh if that is bad
\item the initial iterate for the (SNES-based) solver is clear: $\bu,p$ come from solution of previous time step, and $b$ starts at zero
\end{enumerate}



\small

\bigskip
\bibliography{simp}
\bibliographystyle{siam}

\end{document}
